<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF & Image Size Reducer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #7209b7;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4bb543;
            --warning: #ffcc00;
            --danger: #dc3545;
            --bg: #f5f7fa;
            --card-bg: white;
            --text: var(--dark);
        }

        /* DARK MODE OVERRIDES */
        [data-theme="dark"] {
            --primary: #5c7cfa;
            --secondary: #9775fa;
            --accent: #c084fc;
            --light: #212529;
            --dark: #f8f9fa;
            --success: #22c55e;
            --warning: #facc15;
            --danger: #ef4444;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #e2e8f0;
        }

        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
        body{
            background:linear-gradient(135deg,var(--bg) 0%,#c3cfe2 100%);
            color:var(--text);
            line-height:1.6;
            min-height:100vh;
            padding:20px;
            transition:background .3s,color .3s;
        }
        .container{max-width:1200px;margin:0 auto;}
        header{
            text-align:center;margin-bottom:40px;padding:30px;
            background:var(--card-bg);border-radius:15px;
            box-shadow:0 10px 30px rgba(0,0,0,.1);
            position:relative;
            transition:background .3s;
        }
        h1{color:var(--primary);margin-bottom:10px;font-size:2.5rem;}
        .subtitle{color:var(--secondary);font-size:1.2rem;max-width:600px;margin:0 auto;}
        .main-content{display:grid;grid-template-columns:1fr 1fr;gap:30px;}
        @media(max-width:768px){.main-content{grid-template-columns:1fr;}}
        .card{
            background:var(--card-bg);border-radius:15px;padding:25px;
            box-shadow:0 10px 30px rgba(0,0,0,.1);
            transition:transform .3s,background .3s;
        }
        .card:hover{transform:translateY(-5px);}
        .card h2{color:var(--primary);margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid #f0f0f0;}
        .upload-area{
            border:3px dashed var(--primary);border-radius:10px;padding:40px 20px;
            text-align:center;margin-bottom:20px;cursor:pointer;transition:all .3s;
            background:rgba(67,97,238,.05);
        }
        .upload-area:hover{background:rgba(67,97,238,.1);}
        .upload-area i{font-size:48px;color:var(--primary);margin-bottom:15px;}
        .file-input{display:none;}
        .file-info{
            margin-top:20px;padding:15px;background:#f8f9fa;border-radius:8px;display:none;
            background:var(--light);color:var(--text);
        }
        .controls{margin-top:25px;}
        .control-group{margin-bottom:20px;}
        label{display:block;margin-bottom:8px;font-weight:600;color:var(--text);}
        .slider-container{display:flex;align-items:center;gap:15px;}
        .slider{
            flex:1;height:8px;-webkit-appearance:none;appearance:none;
            background:#ddd;outline:none;border-radius:4px;
        }
        .slider::-webkit-slider-thumb{
            -webkit-appearance:none;width:20px;height:20px;border-radius:50%;
            background:var(--primary);cursor:pointer;transition:background .3s;
        }
        .slider::-webkit-slider-thumb:hover{background:var(--secondary);}
        .slider-value{min-width:40px;text-align:center;font-weight:bold;color:var(--primary);}

        /* BIG MAX WIDTH INPUT */
        .big-input-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 8px;
        }
        .big-number-input {
            flex: 1;
            padding: 14px 16px;
            font-size: 1.4rem;
            font-weight: 600;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: var(--card-bg);
            color: var(--text);
            transition: border .2s;
        }
        .big-number-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67,97,238,.15);
        }
        .px-label {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .button{
            display:inline-block;padding:12px 24px;background:var(--primary);
            color:white;border:none;border-radius:8px;cursor:pointer;font-size:16px;
            font-weight:600;transition:all .3s;width:100%;margin-top:10px;
            box-shadow:0 4px 6px rgba(0,0,0,.1);
        }
        .button:hover{background:var(--secondary);transform:translateY(-2px);box-shadow:0 6px 8px rgba(0,0,0,.15);}
        .button:disabled{background:#ccc;cursor:not-allowed;transform:none;box-shadow:none;}
        .button.download{background:var(--success);}
        .button.download:hover{background:#3a9c33;}
        .preview-container{
            margin-top:20px;min-height:300px;border:1px solid #ddd;border-radius:8px;
            padding:15px;display:flex;flex-direction:column;align-items:center;
            justify-content:center;text-align:center;background:#f9f9f9;
        }
        .preview-image{
            max-width:100%;max-height:250px;display:none;border-radius:5px;
            box-shadow:0 4px 8px rgba(0,0,0,.1);
        }
        .comparison{display:flex;justify-content:space-between;margin-top:20px;gap:15px;}
        .file-stats{
            flex:1;padding:15px;background:#f8f9fa;border-radius:8px;
            text-align:center;transition:all .3s;background:var(--light);
        }
        .file-stats h3{margin-bottom:10px;color:var(--primary);}
        .file-size{font-size:1.5rem;font-weight:bold;margin:10px 0;}
        .original .file-size{color:var(--dark);}
        .reduced .file-size{color:var(--success);}
        .savings{color:var(--success);font-weight:bold;font-size:1.1rem;}
        .loading{display:none;text-align:center;margin:20px 0;}
        .spinner{
            border:5px solid #f3f3f3;border-top:5px solid var(--primary);
            border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;
            margin:0 auto 15px;
        }
        @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
        .progress-bar{width:100%;height:10px;background:#f0f0f0;border-radius:5px;margin:15px 0;overflow:hidden;display:none;}
        .progress{height:100%;background:var(--primary);width:0%;transition:width .3s ease;}
        .feature-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-top:40px;}
        .feature{background:var(--card-bg);padding:20px;border-radius:10px;text-align:center;box-shadow:0 5px 15px rgba(0,0,0,.05);transition:transform .3s;}
        .feature:hover{transform:translateY(-5px);}
        .feature i{font-size:2.5rem;color:var(--primary);margin-bottom:15px;}
        .feature h3{margin-bottom:10px;color:var(--secondary);}
        footer{text-align:center;margin-top:40px;padding:20px;color:var(--secondary);font-size:.9rem;}
        .tabs{display:flex;margin-bottom:20px;border-bottom:1px solid #ddd;}
        .tab{padding:10px 20px;cursor:pointer;border-bottom:3px solid transparent;transition:all .3s;}
        .tab.active{border-bottom:3px solid var(--primary);color:var(--primary);font-weight:bold;}
        .tab-content{display:none;}
        .tab-content.active{display:block;}
        .pdf-preview{width:100%;height:300px;border:1px solid #ddd;border-radius:5px;overflow:auto;background:white;display:none;}
        .pdf-page{margin:10px auto;box-shadow:0 0 5px rgba(0,0,0,.2);}
        .notification{
            position:fixed;top:20px;right:20px;padding:15px 25px;
            background:var(--success);color:white;border-radius:5px;
            box-shadow:0 5px 15px rgba(0,0,0,.2);
            transform:translateX(150%);transition:transform .3s ease;z-index:1000;
        }
        .notification.show{transform:translateX(0);}
        .pdf-info{margin-top:15px;padding:10px;background:#f0f8ff;border-radius:5px;display:none;}

        /* DARK MODE SWITCH */
        .theme-switch{
            position:absolute;top:20px;right:20px;display:flex;align-items:center;gap:8px;
            font-size:14px;color:var(--text);
        }
        .theme-switch input[type=checkbox]{
            appearance:none;width:40px;height:20px;background:#ccc;border-radius:10px;position:relative;
            cursor:pointer;transition:background .3s;
        }
        .theme-switch input[type=checkbox]::after{
            content:"";position:absolute;top:2px;left:2px;width:16px;height:16px;
            background:white;border-radius:50%;transition:transform .3s;
        }
        .theme-switch input[type=checkbox]:checked{background:var(--primary);}
        .theme-switch input[type=checkbox]:checked::after{transform:translateX(20px);}

        /* CUSTOM FILENAME */
        .filename-group{
            margin-top:15px;display:none;align-items:center;gap:10px;
        }
        .filename-group input{
            flex:1;padding:8px 12px;border:1px solid #ddd;border-radius:6px;
            background:var(--card-bg);color:var(--text);
        }
        .filename-group .ext{
            font-weight:600;color:var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>PDF & Image Size Reducer</h1>
            <p class="subtitle">Optimize your files for sharing and storage without compromising quality</p>

            <!-- DARK MODE SWITCH -->
            <div class="theme-switch">
                <label><input type="checkbox" id="themeToggle"> Dark Mode</label>
            </div>
        </header>

        <div class="main-content">
            <div class="card">
                <h2>Upload & Compress</h2>

                <div class="tabs">
                    <div class="tab active" data-tab="image">Image</div>
                    <div class="tab" data-tab="pdf">PDF</div>
                </div>

                <div class="tab-content active" id="image-tab">
                    <div class="upload-area" id="uploadArea">
                        <i>Folder</i>
                        <p>Drag & drop your image here or click to browse</p>
                        <p class="file-types">Supports: JPG, PNG, GIF, WebP</p>
                        <input type="file" id="imageInput" class="file-input" accept=".jpg,.jpeg,.png,.gif,.webp">
                    </div>
                </div>

                <div class="tab-content" id="pdf-tab">
                    <div class="upload-area" id="pdfUploadArea">
                        <i>Document</i>
                        <p>Drag & drop your PDF here or click to browse</p>
                        <p class="file-types">Supports: PDF files</p>
                        <input type="file" id="pdfInput" class="file-input" accept=".pdf">
                    </div>

                    <div class="pdf-info" id="pdfInfo">
                        <p><strong>Pages:</strong> <span id="pageCount">-</span></p>
                        <p><strong>Compression Method:</strong> Image Quality Reduction</p>
                    </div>
                </div>

                <div class="file-info" id="fileInfo">
                    <p><strong>File Name:</strong> <span id="fileName">-</span></p>
                    <p><strong>File Size:</strong> <span id="fileSize">-</span></p>
                    <p><strong>File Type:</strong> <span id="fileType">-</span></p>
                </div>

                <div class="controls">
                    <div class="control-group">
                        <label for="qualitySlider">Compression Quality</label>
                        <div class="slider-container">
                            <input type="range" id="qualitySlider" class="slider" min="10" max="100" value="80">
                            <span id="qualityValue" class="slider-value">80%</span>
                        </div>
                    </div>

                    <!-- BIG MAX WIDTH INPUT -->
                    <div class="control-group" id="imageControls">
                        <label for="maxWidth">Max Width (pixels)</label>
                        <div class="big-input-wrapper">
                            <input type="number" id="maxWidth" class="big-number-input" value="1200" min="100" max="5000" step="50">
                            <span class="px-label">px</span>
                        </div>
                    </div>

                    <div class="control-group" id="pdfControls" style="display:none;">
                        <label for="dpiSlider">DPI Reduction</label>
                        <div class="slider-container">
                            <input type="range" id="dpiSlider" class="slider" min="72" max="300" value="150">
                            <span id="dpiValue" class="slider-value">150 DPI</span>
                        </div>
                        <small>Lower DPI reduces file size but may affect text clarity</small>
                    </div>

                    <!-- CUSTOM FILENAME INPUT -->
                    <div class="filename-group" id="filenameGroup">
                        <label for="customFilename">Download as:</label>
                        <input type="text" id="customFilename" placeholder="Enter name">
                        <span class="ext" id="fileExtension"></span>
                    </div>

                    <div class="progress-bar">
                        <div class="progress" id="progress"></div>
                    </div>

                    <button id="reduceButton" class="button" disabled>Reduce File Size</button>
                    <button id="downloadButton" class="button download" disabled>Download Reduced File</button>
                </div>

                <div class="loading" id="loadingIndicator">
                    <div class="spinner"></div>
                    <p>Processing your file...</p>
                </div>
            </div>

            <div class="card">
                <h2>Preview & Results</h2>
                <div class="preview-container" id="previewContainer">
                    <p>Your file preview will appear here after processing</p>
                    <img id="previewImage" class="preview-image" alt="Preview">
                    <div id="pdfPreview" class="pdf-preview"></div>
                </div>

                <div class="comparison">
                    <div class="file-stats original">
                        <h3>Original</h3>
                        <div class="file-size" id="originalSize">-</div>
                        <p>File Size</p>
                    </div>

                    <div class="file-stats reduced">
                        <h3>Reduced</h3>
                        <div class="file-size" id="reducedSize">-</div>
                        <p>File Size</p>
                        <p class="savings" id="savingsPercent">-</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="feature-list">
            <div class="feature"><i>Lock</i><h3>Secure Processing</h3><p>All files are processed locally in your browser. No uploads to external servers.</p></div>
            <div class="feature"><i>Zap</i><h3>Fast Compression</h3><p>Reduce file sizes quickly without noticeable quality loss.</p></div>
            <div class="feature"><i>Save</i><h3>Save Storage</h3><p>Optimize files for email attachments and cloud storage.</p></div>
            <div class="feature"><i>Phone</i><h3>Mobile Friendly</h3><p>Works perfectly on all devices and screen sizes.</p></div>
        </div>

        <footer>
            <p>Â© 2025 PDF & Image Size Reducer | All processing happens in your browser - your files are never uploaded to any server</p>
        </footer>
    </div>

    <div class="notification" id="notification">File processed successfully!</div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

            const themeToggle = document.getElementById('themeToggle');
            const uploadArea = document.getElementById('uploadArea');
            const pdfUploadArea = document.getElementById('pdfUploadArea');
            const imageInput = document.getElementById('imageInput');
            const pdfInput = document.getElementById('pdfInput');
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const fileType = document.getElementById('fileType');
            const qualitySlider = document.getElementById('qualitySlider');
            const qualityValue = document.getElementById('qualityValue');
            const dpiSlider = document.getElementById('dpiSlider');
            const dpiValue = document.getElementById('dpiValue');
            const maxWidthInput = document.getElementById('maxWidth');
            const reduceButton = document.getElementById('reduceButton');
            const downloadButton = document.getElementById('downloadButton');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const progressBar = document.querySelector('.progress-bar');
            const progress = document.getElementById('progress');
            const previewContainer = document.getElementById('previewContainer');
            const previewImage = document.getElementById('previewImage');
            const pdfPreview = document.getElementById('pdfPreview');
            const originalSize = document.getElementById('originalSize');
            const reducedSize = document.getElementById('reducedSize');
            const savingsPercent = document.getElementById('savingsPercent');
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const imageControls = document.getElementById('imageControls');
            const pdfControls = document.getElementById('pdfControls');
            const pdfInfo = document.getElementById('pdfInfo');
            const pageCount = document.getElementById('pageCount');
            const notification = document.getElementById('notification');

            const filenameGroup = document.getElementById('filenameGroup');
            const customFilename = document.getElementById('customFilename');
            const fileExtension = document.getElementById('fileExtension');

            let originalFile = null;
            let reducedFile = null;
            let originalFileSize = 0;
            let currentFileType = 'image';
            let pdfDoc = null;
            let fileExt = '';

            // DARK MODE
            themeToggle.addEventListener('change', () => {
                document.documentElement.dataset.theme = themeToggle.checked ? 'dark' : 'light';
                localStorage.setItem('theme', themeToggle.checked ? 'dark' : 'light');
            });
            if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                themeToggle.checked = true;
                document.documentElement.dataset.theme = 'dark';
            }

            // TABS
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    tabContents.forEach(c => c.classList.toggle('active', c.id === `${tabId}-tab`));
                    currentFileType = tabId;
                    resetFileSelection();
                    imageControls.style.display = tabId === 'image' ? 'block' : 'none';
                    pdfControls.style.display = tabId === 'pdf' ? 'block' : 'none';
                    pdfInfo.style.display = 'none';
                });
            });

            // UPLOAD
            uploadArea.addEventListener('click', () => imageInput.click());
            pdfUploadArea.addEventListener('click', () => pdfInput.click());

            [uploadArea, pdfUploadArea].forEach(area => {
                area.addEventListener('dragover', e => { e.preventDefault(); area.style.backgroundColor = 'rgba(67,97,238,.2)'; });
                area.addEventListener('dragleave', () => area.style.backgroundColor = '');
                area.addEventListener('drop', e => {
                    e.preventDefault(); area.style.backgroundColor = '';
                    if (e.dataTransfer.files.length) handleFileSelection(e.dataTransfer.files[0]);
                });
            });

            imageInput.addEventListener('change', e => e.target.files.length && handleFileSelection(e.target.files[0]));
            pdfInput.addEventListener('change', e => e.target.files.length && handleFileSelection(e.target.files[0]));

            qualitySlider.addEventListener('input', () => qualityValue.textContent = `${qualitySlider.value}%`);
            dpiSlider.addEventListener('input', () => dpiValue.textContent = `${dpiSlider.value} DPI`);

            reduceButton.addEventListener('click', reduceFileSize);
            downloadButton.addEventListener('click', downloadReducedFile);

            function handleFileSelection(file) {
                const allowed = currentFileType === 'image'
                    ? ['image/jpeg','image/jpg','image/png','image/gif','image/webp']
                    : ['application/pdf'];
                if (!allowed.includes(file.type)) {
                    alert(`Please select a supported ${currentFileType.toUpperCase()} file`);
                    return;
                }

                originalFile = file;
                originalFileSize = file.size;
                fileExt = file.name.split('.').pop().toLowerCase();

                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                fileType.textContent = file.type.split('/')[1].toUpperCase();
                fileInfo.style.display = 'block';
                originalSize.textContent = formatFileSize(file.size);

                resetResultUI();
                reduceButton.disabled = false;
                downloadButton.disabled = true;
                filenameGroup.style.display = 'none';

                if (currentFileType === 'image') {
                    const reader = new FileReader();
                    reader.onload = e => {
                        previewImage.src = e.target.result;
                        previewImage.style.display = 'block';
                        previewContainer.querySelector('p').style.display = 'none';
                    };
                    reader.readAsDataURL(file);
                } else {
                    previewContainer.querySelector('p').textContent = 'Loading PDF...';
                    const reader = new FileReader();
                    reader.onload = e => {
                        const typedarray = new Uint8Array(e.target.result);
                        pdfjsLib.getDocument(typedarray).promise.then(pdf => {
                            pdfDoc = pdf;
                            pageCount.textContent = pdf.numPages;
                            pdfInfo.style.display = 'block';
                            renderPdfPage(pdf, 1);
                        }).catch(err => {
                            console.error(err);
                            previewContainer.querySelector('p').textContent = 'Error loading PDF.';
                        });
                    };
                    reader.readAsArrayBuffer(file);
                }
            }

            function renderPdfPage(pdf, pageNum) {
                pdf.getPage(pageNum).then(page => {
                    const viewport = page.getViewport({scale:0.5});
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    page.render({canvasContext:ctx, viewport}).promise.then(() => {
                        pdfPreview.innerHTML = '';
                        pdfPreview.appendChild(canvas);
                        pdfPreview.style.display = 'block';
                        previewContainer.querySelector('p').style.display = 'none';
                    });
                });
            }

            function reduceFileSize() {
                if (!originalFile) return;
                loadingIndicator.style.display = 'block';
                progressBar.style.display = 'block';
                reduceButton.disabled = true;

                let prog = 0;
                const int = setInterval(() => {
                    prog += 5;
                    progress.style.width = `${prog}%`;
                    if (prog >= 90) clearInterval(int);
                }, 100);

                setTimeout(() => {
                    if (currentFileType === 'image') reduceImageSize();
                    else reducePdfSize();
                    progress.style.width = '100%';
                    setTimeout(() => progressBar.style.display = 'none', 500);
                }, 1000);
            }

            function reduceImageSize() {
                const reader = new FileReader();
                reader.onload = e => {
                    const img = new Image();
                    img.onload = () => {
                        const maxW = parseInt(maxWidthInput.value);
                        const scale = Math.min(1, maxW / img.width);
                        const w = Math.floor(img.width * scale);
                        const h = Math.floor(img.height * scale);

                        const canvas = document.createElement('canvas');
                        canvas.width = w; canvas.height = h;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, w, h);

                        const q = qualitySlider.value / 100;
                        canvas.toBlob(blob => {
                            reducedFile = blob;
                            finalizeReduction(blob.size);
                            previewImage.src = URL.createObjectURL(blob);
                            previewImage.style.display = 'block';
                            previewContainer.querySelector('p').style.display = 'none';
                            showNotification('Image compressed successfully!');
                        }, originalFile.type, q);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(originalFile);
            }

            async function reducePdfSize() {
                if (!pdfDoc) return;
                try {
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF();
                    const total = pdfDoc.numPages;
                    const dpi = parseInt(dpiSlider.value);
                    const q = qualitySlider.value / 100;

                    for (let i = 1; i <= total; i++) {
                        const page = await pdfDoc.getPage(i);
                        const scale = dpi / 72;
                        const vp = page.getViewport({scale});
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = vp.width; canvas.height = vp.height;
                        await page.render({canvasContext:ctx, viewport:vp}).promise;

                        const imgData = canvas.toDataURL('image/jpeg', q);
                        if (i > 1) pdf.addPage();
                        const pdfW = pdf.internal.pageSize.getWidth();
                        const imgH = (canvas.height * pdfW) / canvas.width;
                        pdf.addImage(imgData, 'JPEG', 0, 0, pdfW, imgH);

                        progress.style.width = `${(i / total) * 100}%`;
                    }

                    const blob = pdf.output('blob');
                    reducedFile = blob;
                    finalizeReduction(blob.size);
                    showNotification('PDF compressed successfully!');
                } catch (err) {
                    console.error(err);
                    alert('Error processing PDF.');
                } finally {
                    loadingIndicator.style.display = 'none';
                    reduceButton.disabled = false;
                }
            }

            function finalizeReduction(reducedBytes) {
                reducedSize.textContent = formatFileSize(reducedBytes);
                const saved = originalFileSize - reducedBytes;
                const pct = (saved / originalFileSize * 100).toFixed(1);
                savingsPercent.textContent = `${pct}% smaller`;
                downloadButton.disabled = false;
                loadingIndicator.style.display = 'none';
                reduceButton.disabled = false;

                customFilename.value = originalFile.name.replace(/\.[^.]+$/, '');
                fileExtension.textContent = '.' + fileExt;
                filenameGroup.style.display = 'flex';
            }

            function downloadReducedFile() {
                if (!reducedFile) return;
                const name = customFilename.value.trim() || originalFile.name.replace(/\.[^.]+$/, '');
                const url = URL.createObjectURL(reducedFile);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${name}.${fileExt}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showNotification('File downloaded successfully!');
            }

            function formatFileSize(bytes) {
                if (!bytes) return '0 Bytes';
                const k = 1024, sizes = ['Bytes','KB','MB','GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;
            }

            function resetFileSelection() {
                originalFile = reducedFile = pdfDoc = null;
                fileInfo.style.display = pdfInfo.style.display = filenameGroup.style.display = 'none';
                reduceButton.disabled = downloadButton.disabled = true;
                previewImage.style.display = pdfPreview.style.display = 'none';
                previewContainer.querySelector('p').style.display = 'block';
                previewContainer.querySelector('p').textContent = 'Your file preview will appear here after processing';
                originalSize.textContent = reducedSize.textContent = savingsPercent.textContent = '-';
            }

            function resetResultUI() {
                reducedSize.textContent = savingsPercent.textContent = '-';
                previewImage.style.display = pdfPreview.style.display = 'none';
                previewContainer.querySelector('p').style.display = 'block';
                previewContainer.querySelector('p').textContent = 'Your file preview will appear here after processing';
            }

            function showNotification(msg) {
                notification.textContent = msg;
                notification.classList.add('show');
                setTimeout(() => notification.classList.remove('show'), 3000);
            }
        });
    </script>
</body>
</html>